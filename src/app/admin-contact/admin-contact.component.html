<!-- Navigation -->
<nav class="navigation mb-3">
  <a [routerLink]="['/']" routerLinkActive="router-link-active">🏠 Zum Hauptmenü</a>
</nav>

<!-- Neuen lokalen Kontakt erstellen -->
<section class="new-contact-form mb-4">
  <h2>Neuen lokalen Kontakt erstellen</h2>

  <label>
    Name:
    <input type="text" [(ngModel)]="newContact.name" />
  </label>

  <label>
    Titel:
    <input type="text" [(ngModel)]="newContact.title" />
  </label>

  <label>
    Adresse:
    <input type="text" [(ngModel)]="newContact.address" />
  </label>

  <label>
    Telefon:
    <input type="text" [(ngModel)]="newContact.phone" />
  </label>

  <label>
    E-Mail:
    <input type="email" [(ngModel)]="newContact.email" />
  </label>

  <label>
    Link:
    <input type="text" [(ngModel)]="newContact.link" />
  </label>

  <label>
    Beschreibung:
    <textarea [(ngModel)]="newContact.description"></textarea>
  </label>

  <label>
    Bild:
    <input type="file" (change)="onImageSelected($event)" />
  </label>

  <div *ngIf="newContact.photo">
    <img [src]="newContact.photo" [alt]="'Bild von ' + newContact.name" width="80" />
  </div>

  <div class="form-actions">
    <button (click)="saveNewContact()">💾 Kontakt speichern</button>
    <button (click)="resetNewContact()">🧹 Zurücksetzen</button>
  </div>
</section>

<hr />

<!-- Lokale Kontakte -->
<section class="local-contacts mb-4">
  <h2>Lokale Kontakte</h2>

  <article class="contact-card" *ngFor="let contact of localContacts">
    <h3>{{ contact.name }}</h3>
    <p *ngIf="contact.title"><strong>Titel:</strong> {{ contact.title }}</p>
    <p *ngIf="contact.address"><strong>Adresse:</strong> {{ contact.address }}</p>
    <p *ngIf="contact.phone"><strong>Telefon:</strong> {{ contact.phone }}</p>
    <p *ngIf="contact.email">
      <strong>E-Mail:</strong> <a [href]="'mailto:' + contact.email">{{ contact.email }}</a>
    </p>
    <p *ngIf="contact.link">
      <strong>Link:</strong> <a [href]="contact.link" target="_blank" rel="noopener">{{ contact.link }}</a>
    </p>
    <p *ngIf="contact.description"><strong>Beschreibung:</strong> {{ contact.description }}</p>
    <img *ngIf="contact.photo" [src]="contact.photo" [alt]="'Bild von ' + contact.name" width="80" />

    <div class="contact-actions">
      <button (click)="selectLocalContact(contact)">Karte anzeigen</button>
      <button (click)="confirmDeleteContact(contact)">🗑️ Löschen</button>
    </div>
  </article>
</section>

<hr />

<!-- Service-Kontakte (Backend) -->
<section class="service-contacts mb-4">
  <h2>Service-Kontakte</h2>

  <table class="table table-hover">
    <thead>
      <tr>
        <th>Bild</th>
        <th>Kennung</th>
        <th>Name</th>
        <th>Telefon</th>
        <th>Rolle</th>
        <th>Optionen</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let contact of contacts">
        <td>
          <img [src]="contact.photo ? './assets/photos/' + contact.photo : contact.image" alt="Kontaktbild"
            width="100" />
        </td>
        <td>{{ contact.identity }}</td>
        <td>{{ contact.displayName || contact.name }}</td>
        <td>{{ contact.tel || contact.phone }}</td>
        <td>{{ contact.role }}</td>
        <td class="action-buttons">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target=".editModal"
            (click)="chooseContact(contact); resetDataForEditModal()">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target=".deleteModal"
            (click)="chooseContact(contact)">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</section>

<hr />

<!-- Karten -->
<section class="cards mb-4">
  <h2>Karten</h2>

  <div class="card-grid">
    <article class="card" *ngFor="let card of cards; trackBy: trackCardById">
      <div class="card-content">
        <h3>{{ card.title }}</h3>
        <p><strong>Name:</strong> {{ card.name }}</p>
        <p><strong>Adresse:</strong> {{ card.address }}</p>
        <p><strong>Telefon:</strong> {{ card.phone }}</p>
        <p><strong>Beschreibung:</strong> {{ card.description }}</p>
        <p *ngIf="card.link">
          <strong>Link:</strong> <a [href]="card.link" target="_blank" rel="noopener">{{ card.link }}</a>
        </p>
        <p><strong>Kontakt-ID:</strong> {{ card.contactId }}</p>
        <div *ngIf="card.image" class="card-image">
          <img [src]="card.image" alt="Kartenbild" />
        </div>
        <div class="card-actions">
          <button (click)="editCard(card)">Bearbeiten</button>
          <button (click)="confirmDeleteCard(card)">🗑️ Löschen</button>
          <button *ngIf="card.link" (click)="copyLink(card.link)">🔗 Link kopieren</button>
        </div>
      </div>
    </article>
  </div>
</section>

<!-- Karte bearbeiten -->
<section *ngIf="isEditingCard && selectedCard" class="edit-card-form mb-4">
  <h2>Karte bearbeiten</h2>

  <label>Titel: <input type="text" [(ngModel)]="selectedCard.title" /></label>
  <label>Name: <input type="text" [(ngModel)]="selectedCard.name" /></label>
  <label>Adresse: <input type="text" [(ngModel)]="selectedCard.address" /></label>
  <label>Telefon: <input type="text" [(ngModel)]="selectedCard.phone" /></label>
  <label>Beschreibung: <textarea [(ngModel)]="selectedCard.description"></textarea></label>
  <label>Link: <input type="text" [(ngModel)]="selectedCard.link" /></label>

  <div *ngIf="selectedCard.image">
    <img [src]="selectedCard.image" alt="Kartenbild" width="120" />
  </div>

  <input type="file" (change)="onEditCardImageSelected($event)" />
  <div class="dropzone" (dragover)="onDragOver($event)" (drop)="onEditCardImageDropped($event)">
    Bild hierher ziehen
  </div>

  <button type="button" (click)="showCardCamera = true">📷 Kamera</button>
  <app-camera-functions *ngIf="showCardCamera" (imageTaken)="onEditCardCameraImage($event)"></app-camera-functions>

  <button type="button" (click)="showCardCropper = true" [disabled]="!selectedCard.image">✂️ Zuschneiden</button>
  <app-cropper-functions *ngIf="showCardCropper && selectedCard.image" [imageSrc]="selectedCard.image"
    [shape]="cropShape" (cropped)="onEditCardCropped($event)">
  </app-cropper-functions>

  <div class="form-actions">
    <button (click)="saveEditedCard()">💾 Speichern</button>
    <button (click)="cancelEditCard()">Abbrechen</button>
  </div>
</section>

<!-- Person suchen -->
<section class="search-person mt-2 mb-3">
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target=".searchModal"
    (click)="resetDataForSearchModal()">
    🔍 Person suchen
  </button>
</section>

<!-- Modals (searchModal, editModal, deleteModal) werden separat definiert -->
